(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"38f2":function(e,t,a){"use strict";var i=a("b0f4"),n=a.n(i);n.a},"580c":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"compose"},[a("div",{staticClass:"nav-bar"},[a("i",{staticClass:"iconfont icon-back",on:{click:function(t){return e.$router.back()}}}),"Compose"===e.$route.name&&e.$store.state.user.isLogin?a("img",{attrs:{src:e.$store.state.user.avatar,alt:""}}):e._e(),a("span",{staticClass:"send-btn",class:{"can-send":e.canSend},on:{click:e.newWeibo}},[e._v("发送")])]),a("div",{staticClass:"content-preview"},[a("textarea-autosize",{ref:"textarea",attrs:{placeholder:"分享新鲜事...","min-height":70},model:{value:e.newRecordData.content,callback:function(t){e.$set(e.newRecordData,"content",t)},expression:"newRecordData.content"}}),a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:e.aboutUploadFile.showPreview,expression:"aboutUploadFile.showPreview"}],ref:"uploader",attrs:{"before-read":e.beforeRead,"after-read":e.afterRead,multiple:""},scopedSlots:e._u([{key:"default",fn:function(){return[a("div",{staticClass:"upload-area"},[a("i",{staticClass:"iconfont icon-add"})])]},proxy:!0}]),model:{value:e.aboutUploadFile.files,callback:function(t){e.$set(e.aboutUploadFile,"files",t)},expression:"aboutUploadFile.files"}})],1),a("div",{ref:"action",staticClass:"hide-btn"},[a("div",{staticClass:"top"},[a("div",{staticClass:"weibo-type",on:{click:e.switchPublicState}},[a("i",{staticClass:"iconfont",class:e.publicStateIcon}),e._v("\n        "+e._s(e.newRecordData.public_state)+"\n      ")])]),a("div",{staticClass:"center"},[a("i",{staticClass:"iconfont icon-tupian",on:{click:e.chooseFile}}),a("i",{staticClass:"iconfont icon-xiaolian",on:{click:e.toggleEmojiBar}})]),e.showEmojiBar?a("div",{staticClass:"bottom"},[a("van-swipe",e._l(e.swipeItemNumber,(function(t){return a("van-swipe-item",{key:t},[a("div",{staticClass:"img-container-container"},e._l(e.filterEmotions(t),(function(i){return a("div",{key:i.value,staticClass:"emotion-container"},[a("img",{key:i.value,staticClass:"emotion",attrs:{src:i.icon,alt:t.value},on:{click:function(t){return e.confirmEmotion(i.value)}}})])})),0)])})),1)],1):e._e()])])},n=[],s=(a("d81d"),a("fb6a"),a("6374")),o=a.n(s),c=(a("4b0a"),a("2bb1")),r=(a("7844"),a("5596")),l=(a("e7e5"),a("d399")),u=(a("e930"),a("8f80")),d=a("2b0e"),f=a("922a"),h=a("031f"),p=a("3f9d");d["a"].use(p["a"]),d["a"].use(u["a"]),d["a"].use(l["a"]),d["a"].use(r["a"]),d["a"].use(c["a"]);var b={name:"index",data:function(){return{aboutUploadFile:{showPreview:!1,files:[]},newRecordData:{content:"",public_state:"公开"},publicStateIcon:"icon-public",canSend:!1,showEmojiBar:!1,emotions:f["a"],textArea:null}},computed:{swipeItemNumber:function(){return Math.ceil(this.emotions.length/21)}},watch:{"newRecordData.content":function(e){this.canSend=""!==e}},methods:{afterRead:function(){this.aboutUploadFile.showPreview=!0},beforeRead:function(){return!0},chooseFile:function(){this.$refs.uploader.chooseFile()},newWeibo:function(){var e=this,t=this.newRecordData.content,a=this.aboutUploadFile.files;if(""===t&&0===a.length);else{var i=this.$store.state.user.id;if(i){var n=new window.FormData;""===t&&(t="转发微博"),n.append("content",t),n.append("user",parseInt(this.$store.state.user.id));var s,c=a.map((function(e){return e.file})),r=o()(c);try{for(r.s();!(s=r.n()).done;){var u=s.value;n.append("images",u)}}catch(f){r.e(f)}finally{r.f()}Object(h["d"])(n).then((function(t){e.newRecordData.content="",e.showEmojiBar=!1,e.isSameTimeShare=!1,e.files=[],e.$router.push({name:"Index"}),l["a"].success("发布成功")}))}else{var d=this.$route.path;this.$store.commit("app/SET_REDIRECT_ROUTE",d),this.$router.push({name:"LoginByEmail"})}}},switchPublicState:function(){switch(this.newRecordData.public_state){case"公开":this.newRecordData.public_state="朋友圈",this.publicStateIcon="icon-friend";break;case"朋友圈":this.newRecordData.public_state="私密",this.publicStateIcon="icon-private";break;case"私密":this.newRecordData.public_state="公开",this.publicStateIcon="icon-public";break}},confirmEmotion:function(e){if(window.getSelection)this.textArea.focus(),this.textArea.setRangeText(e),this.textArea.selectionStart+=e.length,this.newRecordData.content=this.textArea.value;else if(document.selection){this.textarea.focus();var t=document.selection.createRange();t.text=e,this.newRecordData.content=this.textArea.value}},toggleEmojiBar:function(){this.showEmojiBar=!this.showEmojiBar,this.textArea=this.$refs.textarea.$el,this.textArea.focus()},filterEmotions:function(e){var t=21;return this.emotions.slice(t*(e-1),t*e)}}},w=b,m=(a("38f2"),a("2877")),v=Object(m["a"])(w,i,n,!1,null,"3749ce99",null);t["default"]=v.exports},b0f4:function(e,t,a){}}]);