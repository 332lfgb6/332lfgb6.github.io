(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"1c7d":function(t,e,a){},"580c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"compose"},[a("div",{staticClass:"nav-bar"},[a("i",{staticClass:"iconfont icon-back",on:{click:function(e){return t.$router.back()}}}),"Compose"===t.$route.name&&t.$store.state.user.isLogin?a("img",{attrs:{src:t.$store.state.user.avatar,alt:""}}):t._e(),a("span",{staticClass:"send-btn",class:{"can-send":t.canSend},on:{click:t.newWeibo}},[t._v("发送")])]),a("div",{staticClass:"content-preview"},[a("textarea-autosize",{ref:"textarea",attrs:{placeholder:"分享新鲜事...","min-height":70},model:{value:t.newRecordData.content,callback:function(e){t.$set(t.newRecordData,"content",e)},expression:"newRecordData.content"}}),a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:t.aboutUploadFile.showPreview,expression:"aboutUploadFile.showPreview"}],ref:"uploader",attrs:{"before-read":t.beforeRead,"after-read":t.afterRead,multiple:""},scopedSlots:t._u([{key:"default",fn:function(){return[a("div",{staticClass:"upload-area"},[a("i",{staticClass:"iconfont icon-add"})])]},proxy:!0}]),model:{value:t.aboutUploadFile.files,callback:function(e){t.$set(t.aboutUploadFile,"files",e)},expression:"aboutUploadFile.files"}})],1),a("div",{ref:"action",staticClass:"hide-btn"},[a("div",{staticClass:"top"},[a("div",{staticClass:"weibo-type",on:{click:t.switchPublicState}},[a("i",{staticClass:"iconfont",class:t.publicStateIcon}),t._v("\n        "+t._s(t.newRecordData.public_state)+"\n      ")])]),a("div",{staticClass:"center"},[a("i",{staticClass:"iconfont icon-tupian",on:{click:t.chooseFile}}),a("i",{staticClass:"iconfont icon-xiaolian",on:{click:t.toggleEmojiBar}})]),t.showEmojiBar?a("div",{staticClass:"bottom"},[a("van-swipe",t._l(t.swipeItemNumber,(function(e){return a("van-swipe-item",{key:e},[a("div",{staticClass:"img-container-container"},t._l(t.filterEmotions(e),(function(i){return a("div",{key:i.value,staticClass:"emotion-container"},[a("img",{key:i.value,staticClass:"emotion",attrs:{src:i.icon,alt:e.value},on:{click:function(e){return t.confirmEmotion(i.value)}}})])})),0)])})),1)],1):t._e()])])},n=[],o=(a("d81d"),a("fb6a"),a("ac1f"),a("5319"),a("6374")),s=a.n(o),c=(a("4b0a"),a("2bb1")),r=(a("7844"),a("5596")),l=(a("e7e5"),a("d399")),u=(a("e930"),a("8f80")),d=a("2b0e"),p=a("922a"),f=a("031f"),h=a("3f9d");d["a"].use(h["a"]),d["a"].use(u["a"]),d["a"].use(l["a"]),d["a"].use(r["a"]),d["a"].use(c["a"]);var b={name:"index",data:function(){return{aboutUploadFile:{showPreview:!1,files:[]},newRecordData:{content:"",public_state:"公开"},publicStateIcon:"icon-public",canSend:!1,showEmojiBar:!1,emotions:p["a"],textArea:null}},computed:{swipeItemNumber:function(){return Math.ceil(this.emotions.length/21)}},watch:{"newRecordData.content":function(t){this.canSend=""!==t}},methods:{afterRead:function(){this.aboutUploadFile.showPreview=!0},beforeRead:function(){return!0},chooseFile:function(){this.$refs.uploader.chooseFile()},newWeibo:function(){var t=this,e=new window.FormData;""===this.newRecordData.content&&this.aboutUploadFile.files.length>0&&(this.newRecordData.content="分享图片"),this.aboutUploadFile.files.length>0&&(this.newRecordData.type="图片");var a=this.newRecordData.content.replace(/[<|>]/g,"");a.replace(/#(.*?)#/g,(function(){return e.append("topic_name",arguments[1]),arguments[0]})),e.append("content",a),e.append("type",this.newRecordData.type),e.append("public_state",this.newRecordData.public_state),e.append("user",parseInt(this.$store.state.user.id));var i,n=this.aboutUploadFile.files.map((function(t){return t.file})),o=s()(n);try{for(o.s();!(i=o.n()).done;){var c=i.value;e.append("images",c)}}catch(r){o.e(r)}finally{o.f()}Object(f["d"])(e).then((function(e){t.newRecordData.content="",t.publicStateIcon="icon-public",t.showEmojiBar=!1,t.$router.back(),l["a"].success("发布成功")}))},switchPublicState:function(){switch(this.newRecordData.public_state){case"公开":this.newRecordData.public_state="朋友圈",this.publicStateIcon="icon-friend";break;case"朋友圈":this.newRecordData.public_state="私密",this.publicStateIcon="icon-private";break;case"私密":this.newRecordData.public_state="公开",this.publicStateIcon="icon-public";break}},confirmEmotion:function(t){if(window.getSelection)this.textArea.focus(),this.textArea.setRangeText(t),this.textArea.selectionStart+=t.length,this.newRecordData.content=this.textArea.value;else if(document.selection){this.textarea.focus();var e=document.selection.createRange();e.text=t,this.newRecordData.content=this.textArea.value}},toggleEmojiBar:function(){this.showEmojiBar=!this.showEmojiBar,this.textArea=this.$refs.textarea.$el,this.textArea.focus()},filterEmotions:function(t){var e=21;return this.emotions.slice(e*(t-1),e*t)}}},w=b,m=(a("8565"),a("2877")),v=Object(m["a"])(w,i,n,!1,null,"62953c22",null);e["default"]=v.exports},8565:function(t,e,a){"use strict";var i=a("1c7d"),n=a.n(i);n.a}}]);