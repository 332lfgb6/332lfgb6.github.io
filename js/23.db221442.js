(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[23],{"222c":function(t,e,i){},"39f9":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"compose"},[i("div",{staticClass:"nav-bar"},[i("i",{staticClass:"iconfont icon-back",on:{click:function(e){return t.$router.back()}}}),"Share"===t.$route.name?i("span",{staticClass:"share-weibo"},[t._v("转发微博")]):t._e(),i("span",{staticClass:"send-btn",class:{"can-send":t.canSend},on:{click:t.newWeibo}},[t._v("发送")])]),i("div",{staticClass:"content-preview"},[i("textarea-autosize",{ref:"textarea",attrs:{rows:"3",placeholder:"说说分享心得..."},nativeOn:{focus:function(e){return t.textareaGetFocus(e)}},model:{value:t.content[t.$route.params.weiboID],callback:function(e){t.$set(t.content,t.$route.params.weiboID,e)},expression:"content[$route.params.weiboID]"}}),i("van-uploader",{directives:[{name:"show",rawName:"v-show",value:t.showPreview,expression:"showPreview"}],ref:"uploader",attrs:{"max-count":"1","before-read":t.beforeRead,"after-read":t.afterRead,multiple:""},scopedSlots:t._u([{key:"default",fn:function(){return[i("div",{staticClass:"upload-area"},[i("i",{staticClass:"iconfont icon-add"})])]},proxy:!0}]),model:{value:t.files,callback:function(e){t.files=e},expression:"files"}}),i("div",{staticClass:"placeholder"}),i("div",{staticClass:"about-the-weibo"},[i("img",{attrs:{src:t.weibo.user.avatar,alt:""}}),i("div",{staticClass:"right"},[i("div",{staticClass:"nickname"},[t._v("@"+t._s(t.weibo.user.nickname))]),i("div",{staticClass:"content ellipsis-2-lines",domProps:{innerHTML:t._s(t.weibo.content)}})])])],1),i("div",{ref:"action",staticClass:"hide-btn"},[i("div",{staticClass:"top"},[i("div",{staticClass:"same-time-share",on:{click:t.toggleSameTimeShareStatus}},[t.isSameTimeComment?i("i",{staticClass:"iconfont icon-checkbox1"}):i("i",{staticClass:"iconfont icon-checkbox2"}),i("span",[t._v("同时评论")])]),i("div",{staticClass:"weibo-type",on:{click:t.switchPublicState}},[i("i",{staticClass:"iconfont",class:t.publicStateIcon}),t._v("\n        "+t._s(t.publicState)+"\n      ")])]),i("div",{staticClass:"center"},[i("i",{staticClass:"iconfont icon-tupian",on:{click:t.chooseFile}}),i("i",{staticClass:"iconfont icon-xiaolian",on:{click:t.toggleEmojiBar}})]),t.showEmojiBar?i("div",{staticClass:"bottom"},[i("van-swipe",t._l(t.swipeItemNumber,(function(e){return i("van-swipe-item",{key:e},[i("div",{staticClass:"img-container-container"},t._l(t.filterEmotions(e),(function(a){return i("div",{key:a.value,staticClass:"emotion-container"},[i("img",{key:a.value,staticClass:"emotion",attrs:{src:a.icon,alt:e.value},on:{click:function(e){return t.confirmEmotion(a.value)}}})])})),0)])})),1)],1):t._e()])])},s=[],o=(i("e260"),i("d81d"),i("fb6a"),i("d3b7"),i("e6cf"),i("ac1f"),i("3ca3"),i("5319"),i("ddb0"),i("6374")),n=i.n(o),c=(i("4b0a"),i("2bb1")),r=(i("7844"),i("5596")),u=(i("e930"),i("8f80")),l=(i("e7e5"),i("d399")),h=i("2b0e"),p=i("922a"),m=i("031f"),f=i("3f9d"),d=i("9b1d"),b=i("063c");h["a"].use(l["a"]),h["a"].use(f["a"]),h["a"].use(u["a"]),h["a"].use(r["a"]),h["a"].use(c["a"]);var w={name:"index",data:function(){return{isSameTimeComment:!1,showPreview:!1,files:[],publicState:"公开",publicStateIcon:"icon-public",canSend:!1,showEmojiBar:!1,emotions:p["a"],textArea:null,weibo:{user:{}},content:{}}},computed:{swipeItemNumber:function(){return Math.ceil(this.emotions.length/21)},safeContent:function(){return this.content[this.$route.params.weiboID].replace(/[<|>]/g,"")}},watch:{files:function(t){0===t.length?this.showPreview=!1:1===t.length&&(this.showPreview=!0)},content:function(t){this.canSend=""!==t}},created:function(){window.forwardUserPage=this.forwardUserPage,window.forwardTopicPage=this.forwardTopicPage},activated:function(){this.content[this.$route.params.weiboID]||this.$set(this.content,this.$route.params.weiboID,""),this.getWeiboDetail()},methods:{toggleSameTimeShareStatus:function(){this.isSameTimeComment=!this.isSameTimeComment},textareaGetFocus:function(){this.showEmojiBar=!1},forwardUserPage:function(t,e){t.stopPropagation(),this.$router.push({name:"User",params:{user:e}})},forwardTopicPage:function(t,e){t.stopPropagation(),this.$router.push({name:"Topic",params:{topic:e}})},getWeiboDetail:function(){var t=this;Object(m["a"])(this.$route.params.weiboID).then((function(e){t.weibo=e.data,t.weibo.content=Object(d["a"])(t,t.weibo.content)}))},afterRead:function(){this.showPreview=!0},beforeRead:function(){return!0},chooseFile:function(){1===this.files.length&&l["a"].fail("转发只能附带一张图片"),this.$refs.uploader.chooseFile()},load:function(){console.log("加载完毕")},newWeibo:function(){var t=this,e=this.content[this.$route.params.weiboID];if(""!==e||0!==this.files.length){if(!this.$store.state.user.id)return this.$store.commit("app/SET_REDIRECT_ROUTE",this.$route.path),void this.$router.push({name:"LoginByEmail"});var i=new window.FormData;""===e&&(e="转发微博"),i.append("content",this.safeContent),i.append("public_state",this.publicState),i.append("user",parseInt(this.$store.state.user.id)),i.append("related_weibo",parseInt(this.$route.params.weiboID));var a,s=this.files.map((function(t){return t.file})),o=n()(s);try{for(o.s();!(a=o.n()).done;){var c=a.value;i.append("images",c)}}catch(d){o.e(d)}finally{o.f()}if(this.isSameTimeComment||Object(m["d"])(i).then((function(e){t.resetFormData(),t.$router.push(t.$store.state.app.redirectRoute),l["a"].success("转发成功")})),this.isSameTimeComment){var r=new window.FormData;r.append("content",this.safeContent),r.append("user",parseInt(this.$store.state.user.id)),r.append("weibo",parseInt(this.$route.params.weiboID));var u,h=this.files.map((function(t){return t.file})),p=n()(h);try{for(p.s();!(u=p.n()).done;){var f=u.value;r.append("images",f)}}catch(d){p.e(d)}finally{p.f()}Promise.all([Object(m["d"])(i),Object(b["a"])(r)]).then((function(e){t.resetFormData(),t.$router.push(t.$store.state.app.redirectRoute),l["a"].success("转发并评论成功")}))}}},resetFormData:function(){this.content[this.$route.params.weiboID]="",this.publicStateIcon="icon-public",this.showEmojiBar=!1,this.isSameTimeComment=!1,this.files=[]},switchPublicState:function(){switch(this.publicState){case"公开":this.publicState="朋友圈",this.publicStateIcon="icon-friend";break;case"朋友圈":this.publicState="私密",this.publicStateIcon="icon-private";break;case"私密":this.publicState="公开",this.publicStateIcon="icon-public";break}},confirmEmotion:function(t){if(window.getSelection)this.textArea.setRangeText(t),this.textArea.selectionStart+=t.length,this.content[this.$route.params.weiboID]=this.textArea.value;else if(document.selection){var e=document.selection.createRange();e.text=t,this.content[this.$route.params.weiboID]=this.textArea.value}},toggleEmojiBar:function(){this.showEmojiBar=!this.showEmojiBar,this.textArea=this.$refs.textarea.$el},filterEmotions:function(t){var e=21;return this.emotions.slice(e*(t-1),e*t)}}},v=w,C=(i("7b64"),i("2877")),g=Object(C["a"])(v,a,s,!1,null,"81ba219a",null);e["default"]=g.exports},"7b64":function(t,e,i){"use strict";var a=i("222c"),s=i.n(a);s.a}}]);